import streamlit as st
import streamlit.components.v1 as components
import pandas as pd
import plotly.express as px
import plotly.figure_factory as ff


st.set_page_config(layout="wide")
st.title('EarthQuake')


# html embeded def
def embededHTML(file_path) :
    HtmlFile = open(file_path, 'r', encoding = 'utf-8')
    source_code = HtmlFile.read() 
    components.html(source_code, height = 500)


# plotly graph design set def
def set_format():
    fig.update_layout(plot_bgcolor='#FFFFFF')
    fig.update_yaxes(showline=True, tickformat=',', linewidth=1, linecolor='black', mirror=True,gridcolor='#E1E1E1',zerolinecolor='#E1E1E1', automargin=True)
    fig.update_xaxes(showline=True, linewidth=1, linecolor='black', mirror=True)


"""
### 4. λ¶€μ‚°μ‹ μ§€μ§„μ·¨μ•½μ§€λ„ κµ¬μ¶•

**π“„. λ°μ΄ν„° μ„¤λ…**

* [μ„Έμ›€ν„°](https://cloud.eais.go.kr/)μ κ±΄μ¶•λ¬Όλ€μ¥ λ°μ΄ν„°, μ£Όνƒκ°€κ²© λ°μ΄ν„° κ·Έλν”„ λ³€ν™
* ν–‰μ •κµ¬μ—­, μ§€λ²μ£Όμ†, κΈ°κ΄€ λ“± κΈ°λ° λ°μ΄ν„°μ™€ μ—°κ³„
* νμ΄μ¬ ν™κ²½(Jupyter)μ—μ„ blazegraph endpointλ¥Ό ν†µν• SPARQL μ§μλ΅ λ°μ΄ν„° μ¶”μ¶


**π“„. λ¶„μ„ κ³Όμ •**

* νμ΄μ¬ ν™κ²½(Jupyter)μ—μ„ λ°μ΄ν„° λ¶„μ„κ³Ό μ‹κ°ν™” μν–‰
* κ±΄μ¶•λ¬Ό λ…Έν›„λ„, λ‚΄μ§„μ„¤κ³„ μ—¬λ¶€λ¥Ό κ³ λ ¤ν• λ¶€μ‚°μ‹ μ§€μ§„μ·¨μ•½μ§€λ„ λ„μ¶
    * λ…Έν›„κ±΄μ¶•λ¬Ό : κ±΄μ¶•λ¬Ό μ‚¬μ©μΉμΈμΌλ΅λ¶€ν„° 25λ…„μ΄ μ§€λ‚ κ±΄μ¶•λ¬Ό
    * λ‚΄μ§„μ„¤κ³„ μλ¬΄λ€μƒ : κ±΄μ¶•λ²•(2017)μ— λ”°λ¥Έ μ—°λ©΄μ  200m2 μ΄μƒμ κ±΄μ¶•λ¬Ό
    * μ§€μ§„μ·¨μ•½λ„ : **μ „μ²΄ κ±΄μ¶•λ¬Ό λ€λΉ„ λ…Έν›„κ±΄μ¶•λ¬Όμ λΉ„μ¨**κ³Ό **λ‚΄μ§„μ„¤κ³„ μλ¬΄λ€μƒ κ±΄μ¶•λ¬Ό μ λ€λΉ„ λ‚΄μ§„μ„¤κ³„ λ―Έμ¤€μ κ±΄μ¶•λ¬Όμ λΉ„μ¨**μ ν‰κ· 
* μ§€μ§„μΌλ΅ μΈν• μμƒ ν”Όν•΄μ•΅(κ³µλ™μ£Όνƒ κ°€κ²©, λ§μ› λ‹¨μ„) κ³„μ‚°

"""
#### (1) μ‹κµ°κµ¬λ³„ μ§€μ§„μ·¨μ•½μ§€λ„
"""
#### (1) μ‹κµ°κµ¬λ³„ μ§€μ§„μ·¨μ•½μ§€λ„
"""

embededHTML("data/sgg_buildingOld_map.html")

"""
** λ¶€μ‚°μ‹ μ „μ²΄ κ±΄μ¶•λ¬Όμ μ•½ 63%κ°€ 25λ…„ μ΄μƒμ λ…Έν›„κ±΄μ¶•λ¬Ό**
* μ§€μ§„μ·¨μ•½λ„κ°€ κ°€μ¥ λ†’μ€ μ‹κµ°κµ¬λ” λ™κµ¬
* λ¶€μ‚°μ—μ„ μ§€μ§„μ΄ κ°€μ¥ λ§μ΄ μΌμ–΄λ‚λ” κΈ°μ¥κµ°μ μ§€μ§„μ·¨μ•½λ„λ” 41.31λ΅ κ°€μ¥ λ‚®μ.
* κ°•ν• μ§€μ§„μ΄ 3λ² μΌμ–΄λ‚ ν•΄μ΄λ€κµ¬λ” κ±΄μ¶•λ¬Όμ 71%κ°€ λ…Έν›„κ±΄μ¶•λ¬Όμ΄κ³ , λ‚΄μ§„μ„¤κ³„ μ μ©μ΄ ν•„μ”ν• κ±΄μ¶•λ¬Όμ 69%κ°€ λ‚΄μ§„μ„¤κ³„λ¥Ό κ°–μ¶”κ³  μμ§€ μ•μ

"""

"""
#### (2) μλ©΄λ™λ³„ μ§€μ§„μ·¨μ•½μ§€λ„

"""

embededHTML("data/emd_buildingOld_map.html")

"""
* μλ©΄λ™ λ‹¨μ„μ—μ„λ” λ™λκµ¬ μΉ μ‚°λ™μ μ§€μ§„μ·¨μ•½λ„(96.13)κ°€ κ°€μ¥ λ†’μ
* λ™λκµ¬ μΉ μ‚°λ™ κ±΄μ¶•λ¬Ό μ¤‘ 94%μ κ±΄μ¶•λ¬Όμ΄ λ…Έν›„κ±΄μ¶•λ¬Όμ΄κ³ , λ‚΄μ§„μ„¤κ³„ μ μ© λ€μƒμ΄μ§€λ§ λ‚΄μ§„μ„¤κ³„λ¥Ό κ°–μ¶”μ§€ λ»ν• κ±΄μ¶•λ¬Όμ΄ 97%
* ν•΄μ΄λ€κµ¬μ—μ„λ” λ°μ†΅λ™μ μ§€μ§„μ·¨μ•½λ„κ°€ κ°€μ¥ λ†’μΌλ©°(85.25), λ‚΄μ§„μ„¤κ³„ λ―Έμ¤€μ κ±΄μ¶•λ¬Ό λΉ„μ¨(90%)μ΄ λ†’μ

π¨ λ…Έν›„κ±΄μ¶•λ¬Όμ— λ€ν• λ‚΄μ§„μ„¤κ³„ μ†κΈ‰μ μ©μ„ μ„ν• κ΄€λ ¨ μ΅°λ΅€μ μ‹ν–‰, μ¬μ •μ  μ§€μ›μ΄ ν•„μ”

"""


"""
### 5. μ§€μ§„ μμƒ ν”Όν•΄μ•΅

* **μ§€μ§„ μμƒ ν”Όν•΄μ•΅**μ€ μ§€μ§„ λ°μƒ μ‹ λ¶•κ΄΄ μ„ν—μ΄ μλ” κ±΄μ¶•λ¬Ό κ°€κ²©μ ν•©μ„ κµ¬ν•¨
* λ¶•κ΄΄ μ„ν— κ±΄μ¶•λ¬Ό : λ…Έν›„ κ±΄μ¶•λ¬Όμ΄κ³ , λ‚΄μ§„μ„¤κ³„ μλ¬΄λ€μƒμ΄μ§€λ§ λ‚΄μ§„μ„¤κ³„λ¥Ό κ°–μ¶”μ§€ λ»ν• κ±΄μ¶•λ¬Ό

"""

## height μ •λ³΄ μ΅°μ • ν•„μ”

df = pd.read_csv('data/sgg_building_money.csv')

region = st.multiselect("μ§€μ—­μ„ μ„ νƒν•μ„Έμ”.", 
                        ['κ°•μ„κµ¬', 'κΈμ •κµ¬', 'κΈ°μ¥κµ°', 'λ‚¨κµ¬', 'λ™κµ¬', 'λ™λκµ¬', 'λ¶€μ‚°μ§„κµ¬', 'λ¶κµ¬', 'μ‚¬μƒκµ¬', 'μ‚¬ν•κµ¬','μ„κµ¬', 'μμκµ¬', 'μ—°μ κµ¬', 'μ¤‘κµ¬', 'ν•΄μ΄λ€κµ¬'])

chart_df = df[df['divisionName'].isin(region)]
chart_df.rename(columns = {'divisionName' : 'μ‹κµ°κµ¬λ…'}, inplace = True)
chart_df.sort_values(by = 'κ³µλ™μ£Όνƒκ°€κ²©(λ§μ›)', ascending= True, inplace= True)

fig = px.bar(chart_df, x = 'μ‹κµ°κµ¬λ…', y = 'κ³µλ™μ£Όνƒκ°€κ²©(λ§μ›)',  range_y = [0, 600000000], width = 1000)
set_format()
st.plotly_chart(fig)

